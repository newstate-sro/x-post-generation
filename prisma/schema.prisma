// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SystemProcessingType {
  OWN
  OTHER
}

model SystemConfiguration {
  id                    String               @id @default(uuid())
  processingStartedAt   DateTime             @default(now())
  processingCompletedAt DateTime?
  processingType        SystemProcessingType

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TrackedEntityType {
  OWN
  OTHER
}

model TrackedEntity {
  id              String            @id @default(uuid())
  type            TrackedEntityType
  name            String
  description     String
  facebookPageUrl String            @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  posts               Post[]
  reactions           Reaction[]
  promptConfiguration PromptConfiguration?
}

model PromptConfiguration {
  id                String  @id @default(uuid())
  trackedEntityId   String  @unique
  toneOfVoicePrompt String
  userPrompt        String
  isActive          Boolean

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trackedEntity TrackedEntity @relation(fields: [trackedEntityId], references: [id], onDelete: Cascade)
  reactions     Reaction[]

  @@index([trackedEntityId])
}


enum CategoryEuSk {
  EU
  SK
  NONE
}
model Post {
  id              String @id @default(uuid())
  trackedEntityId String
  categoryEuSk    CategoryEuSk?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  reactions     Reaction[]
  facebookPost  FacebookPost?
  trackedEntity TrackedEntity @relation(fields: [trackedEntityId], references: [id], onDelete: Cascade)

  @@index([trackedEntityId])
}

model FacebookPost {
  id                String   @id @default(uuid())
  postId            String   @unique
  facebookPostId    String   @unique
  url               String
  postedAt          DateTime
  text              String
  likes             Int      @default(0)
  comments          Int      @default(0)
  shares            Int      @default(0)
  topReactionsCount Int      @default(0)
  isVideo           Boolean  @default(false)
  viewsCount        Int      @default(0)
  fullResponse      Json

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model Reaction {
  id                    String @id @default(uuid())
  trackedEntityId       String
  postId                String
  promptConfigurationId String
  text                  String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  trackedEntity       TrackedEntity       @relation(fields: [trackedEntityId], references: [id], onDelete: Cascade)
  post                Post                @relation(fields: [postId], references: [id], onDelete: Cascade)
  promptConfiguration PromptConfiguration @relation(fields: [promptConfigurationId], references: [id], onDelete: Cascade)

  @@index([trackedEntityId])
  @@index([postId])
  @@index([promptConfigurationId])
}

model SystemPromptConfiguration {
  id String @id @default(uuid())
  categoryEuSkPrompt String
  euPoliticsPrompt String
  skPoliticsPrompt String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
